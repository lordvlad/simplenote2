// Generated by CoffeeScript 1.6.2
(function() {
  var $, $doc, $vm, $win, Bookmark, MAXSCREENWIDTHFORMOBILE, Node, SimpleNote, Tag, author, date, delay, dimCurtains, email, github, hash, intersect, interval, isArr, isDate, isFn, isNum, isObj, isStr, jump, keys, liftCurtains, log, lowerCurtains, now, obs, revision, revive, sizeOf, store, time, timeout, title, uuid, version, vm, _ref, _ref1,
    __hasProp = {}.hasOwnProperty,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  MAXSCREENWIDTHFORMOBILE = 480;

  $ = jQuery;

  $win = $(window);

  $doc = $(document);

  vm = null;

  $vm = null;

  _ref = JSON.parse($.ajax({
    url: 'build.json',
    async: false
  }).responseText), author = _ref.author, email = _ref.email, github = _ref.github, version = _ref.version, revision = _ref.revision, date = _ref.date;

  (function() {
    var script, scripts, _i, _len, _results;

    scripts = [
      {
        src: "tmpl/nodeTemplate.html",
        id: "nodeTemplate"
      }, {
        src: "tmpl/readonlyNodeTemplate.html",
        id: "readonlyNodeTemplate"
      }, {
        src: "tmpl/bodyTemplate.html",
        id: "bodyTemplate"
      }
    ];
    _results = [];
    for (_i = 0, _len = scripts.length; _i < _len; _i++) {
      script = scripts[_i];
      $.holdReady(true);
      _results.push($('<script id="' + script.id + '" type="text/html">').insertAfter('script:last').load(script.src, function() {
        return $.holdReady(false);
      }));
    }
    return _results;
  })();

  isFn = $.isFunction;

  isArr = $.isArray;

  isObj = $.isPlainObject;

  isNum = $.isNumeric;

  isStr = function(v) {
    return typeof v === "string";
  };

  isDate = function(v) {
    if (Object.prototype.toString.call(v) !== '[object Date]') {
      return false;
    } else {
      return !isNaN(v.getTime());
    }
  };

  log = function() {
    var _ref1, _ref2;

    return (_ref1 = window.console) != null ? (_ref2 = _ref1.log) != null ? _ref2.apply(window.console, arguments) : void 0 : void 0;
  };

  timeout = {
    set: function(ms, fn) {
      return setTimeout(fn, ms);
    },
    clear: function(t) {
      return clearTimeout(t);
    },
    reset: function(t, ms, fn) {
      clearTimeout(t);
      return t = setTimeout(fn, ms);
    }
  };

  delay = function(fn) {
    return setTimeout(fn, 1);
  };

  interval = {
    set: function(ms, fn) {
      return setInterval(fn, ms);
    },
    clear: function(i) {
      return clearInterval(i);
    },
    reset: function(i, ms, fn) {
      clearInterval(i);
      return i = setInterval(fn, ms);
    }
  };

  store = {
    data: localStorage,
    remove: function(key) {
      return localStorage.removeItem(key);
    },
    set: function(key, val) {
      return localStorage.setItem(key, (isStr(val) ? val : JSON.stringify(val)));
    },
    get: function(key) {
      var e;

      try {
        return JSON.parse(localStorage.getItem(key), revive);
      } catch (_error) {
        e = _error;
        return localStorage.getItem(key);
      }
    }
  };

  revive = function(key, value) {
    var c;

    if (value && (c = value.__constructor) && (c = revive.constructors[c]) && (typeof c.fromJSON === "function")) {
      return c.fromJSON(value);
    } else {
      return value;
    }
  };

  revive.constructors = {};

  obs = function(value, owner) {
    switch (false) {
      case !(value && (value.call || value.read || value.write)):
        return ko.computed(value);
      case !(value && value.map):
        return ko.observableArray(value, owner || this);
      default:
        return ko.observable(value);
    }
  };

  uuid = function(a) {
    if (a) {
      return (a ^ Math.random() * 16 >> a / 4).toString(16);
    } else {
      return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, uuid);
    }
  };

  now = function() {
    return new Date();
  };

  time = (function() {
    var second;

    second = obs(0);
    interval.set(1e3, function() {
      return second(now());
    });
    return second;
  })();

  sizeOf = function(v) {
    var k;

    switch (false) {
      case !isNum(v):
        return v.split("").length;
      case !isStr(v || isArr(v)):
        return v.length;
      case !isObj(v):
        return ((function() {
          var _results;

          _results = [];
          for (k in v) {
            if (!__hasProp.call(v, k)) continue;
            _results.push(k);
          }
          return _results;
        })()).length;
      default:
        return null;
    }
  };

  hash = (function() {
    var update;

    hash = obs("");
    update = function() {
      return hash(location.hash.replace(/#/, "") || "");
    };
    $(window).on("hashchange", update);
    hash.subscribe(function(newHash) {
      return location.hash = newHash;
    });
    update();
    return hash;
  })();

  title = obs({
    read: function() {
      hash();
      return document.title.replace('simpleNote | ', '');
    },
    write: function(v) {
      return document.title = 'simpleNote | ' + v;
    }
  });

  intersect = function(a, b) {
    return a.filter(function(n) {
      return ~b.indexOf(n);
    });
  };

  liftCurtains = function() {
    if (!$('#curtain').is(':visible')) {
      return;
    }
    return $('#curtain').show(1).delay(1).fadeOut();
  };

  lowerCurtains = function() {
    if ($('#curtain').is(':visible')) {
      return;
    }
    return $('#curtain').show(1).delay(1).fadeIn();
  };

  dimCurtains = function() {
    return $('#curtain').show(1).delay(1).css('opacity', 0).fadeTo('medium', 0.5);
  };

  SimpleNote = (function() {
    SimpleNote.activeInstance = null;

    SimpleNote.syncModules = {};

    SimpleNote.liststyletypes = [
      {
        name: "none",
        value: []
      }, {
        name: "1, 2, 3",
        value: ["decimal"]
      }, {
        name: "1., 2., 3.",
        value: ["decimal", "dot"]
      }, {
        name: "1.1, 1.2, 1.3",
        value: ["decimal", "dot", "add"]
      }, {
        name: "a, b, c",
        value: ["lowerAlpha"]
      }, {
        name: "(a), (b), (c)",
        value: ["lowerAlpha", "dot"]
      }, {
        name: "A, B, C",
        value: ["upperAlpha"]
      }, {
        name: "(A), (B), (C)",
        value: ["upperAlpha", "dot"]
      }
    ];

    function SimpleNote(element) {
      this.clearSearchFilter = __bind(this.clearSearchFilter, this);
      this.removeAlert = __bind(this.removeAlert, this);
      this.removeNotification = __bind(this.removeNotification, this);
      this.checkForOptions = __bind(this.checkForOptions, this);
      this.removeTag = __bind(this.removeTag, this);
      this.addTag = __bind(this.addTag, this);
      this.openNode = __bind(this.openNode, this);
      this.addNodeTo = __bind(this.addNodeTo, this);
      this.selectionEditTags = __bind(this.selectionEditTags, this);
      this.selectionRemove = __bind(this.selectionRemove, this);
      this.selectionEditDeadlines = __bind(this.selectionEditDeadlines, this);
      this.selectionArchive = __bind(this.selectionArchive, this);
      this.selectionInvert = __bind(this.selectionInvert, this);
      this.selectionUnselect = __bind(this.selectionUnselect, this);
      this.load = __bind(this.load, this);
      var mod, module, modulename, _ref1,
        _this = this;

      this.$ = $(this);
      this.syncModules = {};
      SimpleNote.activeInstance = this;
      _ref1 = SimpleNote.syncModules;
      for (modulename in _ref1) {
        module = _ref1[modulename];
        mod = new module(this);
        this.syncModules[modulename.toLowerCase()] = mod;
        $(mod).on({
          'statuschange': function() {
            return _this.$.trigger('modulestatuschange', [modulename, _this, mod, arguments[1], arguments[2]]);
          },
          'connected': function() {
            return _this.$.trigger('moduleconnected', [modulename, _this, mod]);
          },
          'disconnected': function() {
            return _this.$.trigger('moduledisconnected', [modulename, _this, mod]);
          },
          'ready': function() {
            return _this.$.trigger('moduleready', [modulename, _this, mod]);
          },
          'loading': function() {
            return _this.$.trigger('moduleloading', [modulename, _this, mod, arguments[1]]);
          },
          'loaded': function() {
            return _this.$.trigger('moduleloaded', [modulename, _this, mod].concat([].slice.call(arguments, 1)));
          },
          'saving': function() {
            return _this.$.trigger('modulesaving', [modulename, _this, mod, arguments[1]]);
          },
          'error': function() {
            return _this.$.trigger('moduleerror', [modulename, _this, mod].concat([].slice.call(arguments, 1)));
          }
        });
      }
      this.$.on({
        'ready': function() {
          return $win.trigger('appReady', _this);
        },
        'online': function() {
          return log('app online', arguments);
        },
        'offline': function() {
          return log('app offline', arguments);
        },
        'modulestatuschange': function(ev, name, vm, mod, to, from) {
          log("" + name + " changed status from " + from + " to " + to);
          if (to === 1 && from === 0) {
            vm.sync(mod);
            return typeof mod.load === "function" ? mod.load() : void 0;
          }
        },
        'moduleloading': function() {
          log(arguments[4]);
          if (arguments[4] === 0) {
            return dimCurtains();
          }
        },
        'moduleloaded': function() {
          liftCurtains();
          return log(arguments);
        },
        'moduleerror': function() {
          liftCurtains();
          return log(arguments);
        },
        'appsetupready': function() {
          return _this.load();
        }
      });
      this.timeout = null;
      this.revived = false;
      this.interval = null;
      this.root = null;
      this.archive = null;
      this.sync = obs(null);
      this.searchFilter = obs("");
      this.editingFilter = obs(false);
      this.currentNode = obs(null);
      this.alerts = obs([]);
      this.notifications = obs([]);
      this.nodes = obs([]);
      this.tags = obs([]);
      this.bookmarks = obs([]);
      this.selectedNodes = obs(function() {
        return _this.nodes.filter('selected');
      });
      this.realFilter = obs(function() {
        var f, _ref2;

        f = _this.searchFilter().split(/\s+/);
        if (!f[0] || ((_ref2 = f[0]) != null ? _ref2[0] : void 0) === '!') {
          return {
            tags: [],
            times: [],
            words: []
          };
        }
        return {
          tags: f.filter(function(n) {
            return n.match(/^#/);
          }).map(function(n) {
            return n.replace(/(?:)/, '');
          }),
          times: f.filter(function(n) {
            return n.match(/^@/);
          }).map(function(n) {
            return n.replace(/@/, '');
          }),
          words: f.filter(function(n) {
            return n.match(/^[^#@]/);
          })
        };
      }).extend({
        debounce: 500
      });
      this.breadcrumbs = obs(function() {
        var a, _ref2;

        a = _this.options.appearance.titles() ? "" : _this.currentNode();
        return ((_ref2 = _this.currentNode()) != null ? typeof _ref2.parents === "function" ? _ref2.parents().concat(a) : void 0 : void 0) || [];
      });
      hash.subscribe(function(id) {
        var _ref2;

        _this.currentNode((id && id.length && _this.nodes.find("id", id)) || (id && id.length && hash('') && _this.root) || _this.root);
        if ((_ref2 = _this.currentNode()) != null) {
          _ref2.editingNote(true);
        }
        return title(_this.currentNode().title());
      });
    }

    SimpleNote.prototype.load = function() {
      this.root = store.get('root');
      this.archive = store.get('archive');
      ko.map(this.options, store.get('options'));
      store.get('bookmarks');
      store.get('tags');
      this.revived = true;
      hash.valueHasMutated();
      return this.$.trigger('ready');
    };

    /*
    revive : =>
      @sync.load ( err, data ) =>
        throw err if err
      @
    
    # saves own data to localStorage
    save : =>
      return if not @revived
      timeout.clear @timeout
      @timeout = timeout.set 100, => 
        store.set 'root', @root.toJSON()
        store.set 'tags', @tags()
        store.set 'bookmarks', @bookmarks()
        store.set 'options', ko.toJSON @options
        if @archive
          store.set 'archive', @archive.toJSON()
      @
    */


    SimpleNote.prototype.startPeriodicalSave = function() {
      this.interval = interval.set(6e4, this.save);
      return this;
    };

    SimpleNote.prototype.stopPeriodicalSave = function() {
      interval.clear(this.interval);
      return this;
    };

    SimpleNote.prototype.selectionUnselect = function() {
      var node, _i, _len, _ref1, _results;

      _ref1 = this.selectedNodes();
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        node = _ref1[_i];
        _results.push(node.selected(false));
      }
      return _results;
    };

    SimpleNote.prototype.selectionInvert = function() {
      var node, _i, _len, _ref1, _results;

      _ref1 = this.nodes();
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        node = _ref1[_i];
        _results.push(node.selected(!node.selected()));
      }
      return _results;
    };

    SimpleNote.prototype.selectionArchive = function() {
      var node, _i, _len, _ref1, _results;

      _ref1 = this.selectedNodes();
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        node = _ref1[_i];
        _results.push(node.archive());
      }
      return _results;
    };

    SimpleNote.prototype.selectionEditDeadlines = function() {
      var d, node, _i, _len, _ref1, _results;

      d = prompt('set a deadline for the selected items', new Date());
      _ref1 = this.selectedNodes();
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        node = _ref1[_i];
        _results.push(node.deadline(d));
      }
      return _results;
    };

    SimpleNote.prototype.selectionRemove = function() {
      var node, _i, _len, _ref1, _results;

      if (confirm("really delete " + (this.selectedNodes().length) + " selected outlines? ATTENTION! Children Nodes will be deleted with their parents!")) {
        _ref1 = this.selectedNodes();
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          node = _ref1[_i];
          _results.push(node._delete());
        }
        return _results;
      }
    };

    SimpleNote.prototype.selectionEditTags = function() {};

    SimpleNote.prototype.addNodeTo = function(parent, options) {
      if (!(parent != null ? parent.id : void 0)) {
        parent = this.current();
      }
      return (new Node($.extend((isObj(options) ? options : {}), {
        parent: parent
      }))).active(true).editingTitle(true);
    };

    SimpleNote.prototype.openNode = function(el) {
      var _ref1;

      return hash((el && el.id) || ((_ref1 = el && el[0] && ko.dataFor(el[0])) != null ? _ref1.id : void 0) || el || this.root.id);
    };

    SimpleNote.prototype.addTag = function() {
      return new Tag({
        name: prompt('set a name', '')
      });
    };

    SimpleNote.prototype.removeTag = function(item) {
      var node, _i, _len, _ref1, _results;

      if (!confirm("really delete the tag named " + (item.name()) + "?")) {
        return;
      }
      this.tags.remove(item);
      _ref1 = this.nodes();
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        node = _ref1[_i];
        _results.push(node.tags.remove(item));
      }
      return _results;
    };

    SimpleNote.prototype.fadeIn = function(el) {
      return $(el).hide().fadeIn('slow');
    };

    SimpleNote.prototype.fadeOut = function(el) {
      return $(el).fadeOut(function() {
        return $(el).remove();
      });
    };

    SimpleNote.prototype.checkForOptions = function(el) {
      var domnode;

      if ((domnode = $('.options', el)).length > 0 && $('[data-bind]', el).length > 0) {
        return ko.applyBindings(this, domnode[0]);
      }
    };

    SimpleNote.prototype.removeNotification = function(item) {
      return this.notifications.remove(item);
    };

    SimpleNote.prototype.removeAlert = function(item) {
      return this.alerts.remove(item);
    };

    SimpleNote.prototype.clearSearchFilter = function() {
      return this.searchFilter('');
    };

    SimpleNote.prototype.getBuild = function() {
      var _this = this;

      return $.getJSON('build.json', function(d) {
        return _this.build = d;
      });
    };

    return SimpleNote;

  })();

  revive.constructors["SimpleNote"] = SimpleNote;

  keys = {
    BACKSPACE: 8,
    TAB: 9,
    ENTER: 13,
    ESC: 27,
    PGUP: 33,
    PGDOWN: 34,
    END: 35,
    HOME: 36,
    LEFT: 37,
    UP: 38,
    RIGHT: 39,
    DOWN: 40,
    SPACE: 32,
    DEL: 46
  };

  SimpleNote.prototype.attachClicks = function() {
    var $tagsMenu, $view, model, _ref1,
      _this = this;

    _ref1 = [this, this.view, this.doc], model = _ref1[0], $view = _ref1[1], $doc = _ref1[2];
    $view.off('click.headline');
    $view.on('click.headline', '.headline', function(e) {
      var $t;

      $t = $(e.target);
      if (!$t.is(".bullet, .action, .info")) {
        return $t.parents(".headline").find("title").focus();
      }
    });
    $view.off('keyup.doc, click.doc');
    $view.on('keyup.doc, click.doc', function() {
      return model.save();
    });
    this.$tagsMenu = $tagsMenu = $('#tagsMenu', $view);
    $tagsMenu.off('dismiss, call, click.li, click.addtag, keydown.input');
    $tagsMenu.data('activeNode', null).on('dismiss', function() {
      return $(this).data('activeNode', null).fadeOut('fast', function() {
        return $(this).css({
          top: '',
          left: ''
        });
      });
    }).on('call', function(e, node, o) {
      var $this;

      $doc.off('click.tagsmenu');
      $this = $(this).data('activeNode', node).position({
        my: 'right top',
        at: 'right bottom',
        of: o.target
      }).fadeIn('fast');
      $this.find('input').focus();
      return $doc.on('click.tagsmenu', function(e) {
        if (e.timeStamp === o.timeStamp || $(e.target).parents('#tagsMenu').length !== 0) {
          return;
        }
        $doc.off('click.tagsmenu');
        return $this.trigger('dismiss');
      });
    }).on('click.li', 'li.list', function() {
      var node, tag;

      tag = ko.dataFor(this);
      node = $tagsMenu.data('activeNode');
      if (node.tags.remove(tag).length === 0) {
        return node.tags.push(tag);
      }
    }).on('click.addtag', 'i.icon-tag.addTag', function() {
      var name;

      if (!(name = $(this).prev().val())) {
        return;
      }
      $tagsMenu.data('node').tags.push(new Tag({
        name: name
      }));
      $(this).next().val('').focus();
      if (window.innerWidth < MAXSCREENWIDTHFORMOBILE) {
        return $tagsMenu.trigger('dismiss');
      }
    }).on('keydown.input', 'input', function(e) {
      if (e.which === keys.ESC) {
        $tagsMenu.trigger('dismiss');
      }
      if (e.which !== keys.ENTER) {
        return;
      }
      return $(this).next().trigger('click');
    });
    $('#search > div > .icon-tags', $view).off('click.icontag');
    $('#search > div >.icon-tags', $view).on('click.icontag', function(e) {
      var t;

      model.editingFilter(true);
      t = $('#tags');
      if (t.is('visible')) {
        return t.slideUp();
      }
      t.slideDown('fast');
      return $doc.on('click.tagsfilter', function(f) {
        if (e.timeStamp === f.timeStamp || $(f.target).is('.icon-trash')) {
          return;
        }
        $doc.off('click.tagsfilter');
        return t.slideUp('fast');
      });
    });
    $('#search > div >.icon-star', $view).off('click.iconstar');
    $('#search > div >.icon-star', $view).on('click.iconstar', function(e) {
      var b;

      model.editingFilter(true);
      b = $('#bookmarks');
      if (b.is('visible')) {
        return b.slideUp();
      }
      b.slideDown('fast');
      return $doc.on('click.bookmarks', function(f) {
        if (e.timeStamp === f.timeStamp || $(f.target).is('.icon-star-half')) {
          return;
        }
        $doc.off('click.bookmarks');
        return b.slideUp('fast');
      });
    });
    $('#search > div > .icon-ellipsis-vertical').off('click.special');
    return $('#search > div > .icon-ellipsis-vertical').on('click.special', function(e) {
      var s;

      s = $('#specialPages');
      if (s.is('visible')) {
        return s.slideUp();
      }
      s.slideDown('fast');
      return $doc.on('click.specialPages', function(f) {
        if (e.timeStamp === f.timeStamp) {
          return;
        }
        $doc.off('click.specialPages');
        return s.slideUp('fast');
      });
    });
  };

  SimpleNote.prototype.detachHotkeys = function() {
    return this.doc.off('keydown.hotkeys');
  };

  SimpleNote.prototype.attachHotkeys = function() {
    var eventToBits, h, hotkeybits, keysToBits, model, stop, _i, _len, _ref1;

    model = this;
    stop = function(e) {
      e.stopPropagation();
      return e.preventDefault();
    };
    eventToBits = function(e) {
      return [e.altKey ? 1 : 0, e.ctrlKey ? 1 : 0, e.shiftKey ? 1 : 0, e.which].join("");
    };
    keysToBits = function(a) {
      var c;

      return [a.match(/alt/i) ? 1 : 0, a.match(/ctrl/i) ? 1 : 0, a.match(/shift/i) ? 1 : 0, ((c = a.match(/(?:ctrl|alt|shift|\s)*(?:\s|^)(\w{2,})(?=\s|$)/i)) && keys[c[1].toUpperCase()]) || ((c = a.match(/(?:ctrl|alt|shift|\s)*(?:\s|^)([\w\d]{1})(?=\s|$)/i)) && (c = c[1].toUpperCase().charCodeAt(0)))].join("");
    };
    hotkeybits = {};
    _ref1 = this.options.hotkeys;
    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
      h = _ref1[_i];
      if (!hotkeybits[keysToBits(h[0])]) {
        hotkeybits[keysToBits(h[0])] = [[h[1], h[2]]];
      } else {
        hotkeybits[keysToBits(h[0])].push([h[1], h[2]]);
      }
    }
    this.$doc.on('keydown.hotkeys', function(e) {
      var $t, k, _base, _j, _len1, _name, _results;

      if (h = hotkeybits[eventToBits(e)]) {
        $t = $(e.target);
        if (!$t[0].nodeType) {
          $t = $view;
        }
        _results = [];
        for (_j = 0, _len1 = h.length; _j < _len1; _j++) {
          k = h[_j];
          if (!k[0] || $t.is(k[0])) {
            if (model.functions[k[1]]) {
              if ((typeof (_base = model.functions)[_name = k[1]] === "function" ? _base[_name](e, $t, ko.dataFor($t[0]), ko.contextFor($t[0]).$root) : void 0) !== -1) {
                _results.push(stop(e));
              } else {
                _results.push(void 0);
              }
            } else {
              _results.push(void 0);
            }
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      }
    });
    this.$doc.on('click', 'i.icon-remove', function(e) {
      return $model.trigger('remove', e.target.nodeType && ko.dataFor(e.target));
    });
    return $model.on('remove', function() {
      return console.log(arguments);
    });
  };

  jump = function(e, n, dir) {
    var c, d, t, _base, _name;

    c = n.filter('.title:visible,.title:focus,.topNotes:visible>div,#sheet>.body>div>h1:visible').xor('.body.active .title:visible:first').xor('body');
    t = typeof c[_name = 'find' + dir] === "function" ? c[_name]('#sheet>.body>div>h1:visible, .topNotes:visible>div, .title:visible')[0] : void 0;
    if (t && (d = ko.dataFor(t))) {
      if (typeof (_base = ko.dataFor(c[0])).active === "function") {
        _base.active(false);
      }
      if ($(t).is('h1')) {
        d.editingTitle(true);
      }
      if ($(t).is('.title')) {
        d.active(true);
      }
      if ($(t).is('.topNotes>div')) {
        return d.editingNote(true);
      }
    }
  };

  SimpleNote.prototype.functions = {
    nextItem: function(e, n) {
      return jump(e, n, 'Next');
    },
    prevItem: function(e, n) {
      return jump(e, n, 'Prev');
    },
    focusSearch: function() {
      $('#tagsmenu').trigger('dismiss');
      return $('#search input').focus();
    },
    blurSearch: function() {
      $('#tagsmenu').trigger('dismiss');
      return $('#search input').blur();
    },
    selectItem: function(e, n, d) {
      return typeof d.toggleSelected === "function" ? d.toggleSelected() : void 0;
    },
    zoomIn: function(e, n, d) {
      return typeof d.open === "function" ? d.open() : void 0;
    },
    zoomOut: function(e, n, d, r) {
      var x, y, _ref1;

      if (r.root === r.current()) {
        return;
      }
      if ((_ref1 = (y = (x = r.current()).editingNote(false).editingTitle(false).parent())) != null) {
        if (typeof _ref1.open === "function") {
          _ref1.open();
        }
      }
      y.editingNote(false);
      return x.active(true);
    },
    addChild: function(e, n, d, r) {
      return typeof r.addNodeTo === "function" ? r.addNodeTo(typeof d.expanded === "function" ? d.expanded(true) : void 0) : void 0;
    },
    addSibling: function(e, n, d, r) {
      return typeof r.addNodeTo === "function" ? r.addNodeTo(d.parent(), {
        position: d.parent().children().indexOf(d) + 1
      }) : void 0;
    },
    editNotes: function(e, n, d) {
      return d.expanded(true).editingNote(true);
    },
    editTitle: function(e, n, d) {
      return d.editingTitle(true);
    },
    foldItem: function(e, n, d, r) {
      return d.toggleExpanded();
    },
    deleteIfEmpty: function(e, n, d, r) {
      var a, b;

      if (n.html().length) {
        return -1;
      }
      a = d.parent().children();
      b = a[a.indexOf(d) - 1];
      d._delete();
      if (b) {
        return b.active(true).editingTitle(true);
      }
    },
    deleteIfEmptyAndStayOnPosition: function(e, n, d, r) {
      var a, b;

      if (n.html().length) {
        return -1;
      }
      a = d.parent().children();
      b = a[a.indexOf(d) + 1];
      d._delete();
      if (b) {
        return b.active(true).editingTitle(true);
      }
    },
    foldAll: function(e, n, d, r) {
      var f, u;

      f = function(x) {
        var y, _i, _len, _ref1, _results;

        x.expanded(false);
        if (x.children().length) {
          _ref1 = x.children();
          _results = [];
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            y = _ref1[_i];
            _results.push(f(y));
          }
          return _results;
        }
      };
      u = function(x, i) {
        var y, _i, _len, _ref1, _results;

        if (i-- <= 0) {
          return;
        }
        x.expanded(true);
        if (x.children().length) {
          _ref1 = x.children();
          _results = [];
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            y = _ref1[_i];
            _results.push(u(y, i));
          }
          return _results;
        }
      };
      f(r.current());
      return u(r.current(), e.which - 48);
    }
  };

  SimpleNote.prototype.options = {
    print: {
      breadcrumbs: obs(false),
      tags: obs(false),
      colors: obs(true)
    },
    appearance: {
      titles: obs(true),
      flatUI: obs(false)
    },
    dropbox: {
      sync: obs(false)
    },
    hotkeys: [['ctrl j', null, 'nextItem'], ['ctrl k', null, 'prevItem'], ['shift up', null, 'zoomOut'], ['shift down', '.title', 'zoomIn'], ['ctrl i', '.title', 'zoomIn'], ['ctrl o', null, 'zoomOut'], ['esc', null, 'focusSearch'], ['esc', '#search input', 'blurFocus'], ['ctrl space', '.title', 'selectItem'], ['ctrl u', '.title', 'foldItem'], ['ctrl 1', null, 'foldAll'], ['ctrl 2', null, 'foldAll'], ['ctrl 3', null, 'foldAll'], ['ctrl 4', null, 'foldAll'], ['ctrl 5', null, 'foldAll'], ['ctrl 6', null, 'foldAll'], ['ctrl 7', null, 'foldAll'], ['enter', '.title', 'addSibling'], ['shift enter', '.title', 'editNotes'], ['shift enter', '.notes>div', 'editTitle'], ['ctrl enter', null, 'addChild'], ['backspace', '.title', 'deleteIfEmpty'], ['del', '.title', 'deleteIfEmptyAndStayOnPosition']]
  };

  /*
    possible event listeners
    'statuschange' : -> log 'dropbox status changed to', {newstatus}
    'connected' : -> log 'dropbox connected'
    'disconnected ' : -> log 'dropbox disconnected'
    'saved'  : -> log 'save to dropbox'
    'saving' : -> log 'saving to dropbox', {percent}
    'loaded'  : -> log 'load from dropbox' {data}
    'loading' : -> log 'loading from dropbox', {percent}
    'ready' : -> log 'dropbox ready'
    'error' : -> log 'dropbox error', arguments
  */


  SimpleNote.SyncModule = (function() {
    SyncModule.prototype.cfg = {};

    SyncModule.prototype.name = '';

    SyncModule.prototype.client = null;

    SyncModule.prototype.data = null;

    SyncModule.prototype.statusText = null;

    SyncModule.prototype.statusColor = null;

    SyncModule.prototype.status = obs(0);

    SyncModule.prototype.save = function() {};

    SyncModule.prototype.load = function() {};

    function SyncModule(data) {
      var prevstatus, statusDef,
        _this = this;

      this.data = data;
      this.$ = $(this);
      if (!this.data) {
        throw new Error('SyncModule needs a data object to be bound to');
      }
      prevstatus = 0;
      statusDef = [['is&nbsp;not&nbsp;set&nbsp;up', ''], ['is&nbsp;ready', 'green'], ['is&nbsp;working', 'saddlebrown'], ['is&nbsp;disconnected', 'orange'], ['has&nbsp;an&nbsp;error', 'red']];
      this.statusText = obs(function() {
        return statusDef[_this.status()][0];
      });
      this.statusColor = obs(function() {
        return statusDef[_this.status()][1];
      });
      this.status.subscribe(function(v) {
        _this.$.trigger('statuschange', [v, prevstatus]);
        return prevstatus = v;
      });
      if (this._init != null) {
        this._init();
      } else {
        this.$.trigger('ready');
      }
    }

    return SyncModule;

  })();

  SimpleNote.syncModules.DropBox = (function(_super) {
    __extends(DropBox, _super);

    function DropBox() {
      _ref1 = DropBox.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    DropBox.prototype.timer = null;

    DropBox.prototype.name = 'dropbox';

    DropBox.prototype.cfg = {
      client: {
        key: "iWIaoxmWAjA=|63jY9RIU/8IYCV9ievpExyDksGG126neiK1a9wac8Q==",
        sandbox: true
      },
      drivers: {
        redirect: {
          rememberUser: true
        }
      }
    };

    DropBox.prototype._init = function() {
      var c, key, _ref2;

      c = false;
      _ref2 = store.data;
      for (key in _ref2) {
        if (!__hasProp.call(_ref2, key)) continue;
        if (key.match(/dropbox-auth/)) {
          c = true;
          this.connect();
          break;
        }
      }
      if (!c) {
        return this.$.trigger('ready', this);
      }
    };

    DropBox.prototype.save = function() {
      var add, ans, c,
        _this = this;

      if (!this.client) {
        return this.$.trigger('error', new Error('dropbox client not initialized'));
      }
      ans = {};
      c = 0;
      add = function(k, e, s) {
        _this.$.trigger('saving', (++c) / 5);
        if (e) {
          _this.status(4);
          _this.$.trigger('error', e);
          return;
        }
        ans[k] = s;
        if (ans.root && ans.bookmarks && ans.tags && ans.archive && ans.options) {
          _this.$.trigger('saved');
          return _this.status(1);
        }
      };
      this.$.trigger('saving', 0 / 5);
      this.client.writeFile('root', JSON.stringify(this.data.root, null, 2), function(e, s) {
        return add('root', e, s);
      });
      this.client.writeFile('bookmarks', JSON.stringify(this.data.bookmarks, null, 2), function(e, s) {
        return add('bookmarks', e, s);
      });
      this.client.writeFile('tags', JSON.stringify(this.data.tags, null, 2), function(e, s) {
        return add('tags', e, s);
      });
      this.client.writeFile('archive', JSON.stringify(this.data.archive, null, 2), function(e, s) {
        return add('archive', e, s);
      });
      return this.client.writeFile('options', JSON.stringify(this.data.options, null, 2), function(e, s) {
        return add('options', e, s);
      });
    };

    DropBox.prototype.saveDelayed = function() {
      return timeout.reset(this.timer, 1000, function() {
        return this.save(callback);
      });
    };

    DropBox.prototype.load = function(callback) {
      var add, ans, c,
        _this = this;

      if (!this.client) {
        return this.$.trigger('error', new Error('dropbox client not initialized'));
      }
      ans = {};
      c = 0;
      add = function(k, e, s) {
        var b, key, value;

        _this.$.trigger('loading', (++c) / 5);
        if (e) {
          _this.status(4);
          _this.$.trigger('error', e);
          return;
        }
        ans[k] = s;
        if (ans.root && ans.bookmarks && ans.tags && ans.archive && ans.options) {
          try {
            b = {};
            for (key in ans) {
              value = ans[key];
              b[key] = JSON.parse(value, revive);
            }
            _this.status(1);
            return _this.$.trigger('loaded', b);
          } catch (_error) {
            e = _error;
            _this.status(4);
            return _this.$.trigger('error', e);
          }
        }
      };
      this.$.trigger('loading', 0 / 5);
      this.status(2);
      this.client.readFile('root', function(e, s) {
        return add('root', e, s);
      });
      this.client.readFile('bookmarks', function(e, s) {
        return add('bookmarks', e, s);
      });
      this.client.readFile('tags', function(e, s) {
        return add('tags', e, s);
      });
      this.client.readFile('archive', function(e, s) {
        return add('archive', e, s);
      });
      return this.client.readFile('options', function(e, s) {
        return add('options', e, s);
      });
    };

    DropBox.prototype.connect = function() {
      var cfg,
        _this = this;

      cfg = this.cfg;
      this.client = new Dropbox.Client(cfg.client);
      this.client.authDriver(new Dropbox.Drivers.Redirect(cfg.drivers.redirect));
      return this.client.authenticate(function(e) {
        _this.status(e ? 4 : 1);
        if (!e) {
          _this.$.trigger('ready');
          return _this.$.trigger('connected');
        }
      });
    };

    DropBox.prototype.disconnect = function() {
      var _this = this;

      if (!this.client || !this.client.signOff) {
        return this.$.trigger('error', new Error('dropbox client not initialized'));
      }
      return this.client.signOff(function() {
        var key;

        _this.status(0);
        if ((function() {
          var _ref2, _results;

          _ref2 = store.data;
          _results = [];
          for (key in _ref2) {
            if (!__hasProp.call(_ref2, key)) continue;
            _results.push(key.match(/dropbox-auth/));
          }
          return _results;
        })()) {
          store.remove(key);
        }
        return _this.$.trigger('disconnected');
      });
    };

    return DropBox;

  })(SimpleNote.SyncModule);

  /*
  @class Tag
  */


  Tag = (function() {
    Tag.fromJSON = function(data) {
      var instance, tag;

      if (tag = SimpleNote.activeInstance.tags.find('id', data.id)) {
        return tag;
      }
      delete data.__constructor;
      instance = new Tag();
      return ko.map(instance, data);
    };

    function Tag(options) {
      this.toggleInFilter = __bind(this.toggleInFilter, this);
      this._delete = __bind(this._delete, this);
      this.remove = __bind(this.remove, this);
      this.edit = __bind(this.edit, this);
      this.toJSON = __bind(this.toJSON, this);
      var _this = this;

      this.id = uuid();
      this.model = SimpleNote.activeInstance;
      this.name = obs((options != null ? options.name : void 0) || "");
      this.color = obs((options != null ? options.color : void 0) || "white");
      this.fgColor = obs(function() {
        if ($.Color(_this.color()).lightness() < .33) {
          return "white";
        } else {
          return "black";
        }
      });
      this.model.tags.push(this);
    }

    Tag.prototype.toJSON = function() {
      return {
        __constructor: 'Tag',
        id: this.id,
        name: this.name(),
        color: this.color()
      };
    };

    Tag.prototype.edit = function() {
      this.name(prompt("change name from " + (this.name()) + " to ...", this.name()) || this.name());
      return this.color(prompt("change color from " + (this.color()) + " to ...", this.color()) || this.color());
    };

    Tag.prototype.remove = function() {
      if (confirm("really delete tag '" + (this.name()) + "'?")) {
        return this._delete;
      }
    };

    Tag.prototype._delete = function() {
      var node, _i, _len, _ref2, _results;

      this.model.tags.remove(this);
      _ref2 = this.model.nodes();
      _results = [];
      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
        node = _ref2[_i];
        _results.push(node.tags.remove(this));
      }
      return _results;
    };

    Tag.prototype.toggleInFilter = function(i, e) {
      if ($(e.target).is('.icon-trash, .icon-pencil')) {
        return;
      }
      if (this.model.searchFilter().match('#' + this.name())) {
        this.model.searchFilter(this.model.searchFilter().replace('#' + this.name(), '').replace(/\s{2,}/g, " ").replace(/^\s*|\s*$/g, "") + " ");
      } else {
        this.model.searchFilter((this.model.searchFilter() + " #" + this.name()).replace(/\s{2,}/g, " ").replace(/^\s*|\s*$/g, "") + " ");
      }
      return this.model.editingFilter(true);
    };

    return Tag;

  }).call(this);

  Bookmark = (function() {
    Bookmark.fromJSON = function(data) {
      var bm, instance;

      if (bm = SimpleNote.activeInstance.bookmarks.find('href', data.href)) {
        return bm;
      }
      delete data.__constructor;
      instance = new Bookmark();
      return ko.map(instance, data);
    };

    Bookmark.active = obs({
      read: function() {
        hash();
        return SimpleNote.activeInstance.bookmarks.find('href', location.href);
      },
      write: null,
      deferEvaluation: true
    });

    Bookmark.toggle = function() {
      var a;

      if (a = SimpleNote.activeInstance.bookmarks.find('href', location.href)) {
        return SimpleNote.activeInstance.bookmarks.remove(a);
      } else {
        return new Bookmark;
      }
    };

    function Bookmark(options) {
      this.toJSON = __bind(this.toJSON, this);      this.model = SimpleNote.actimd;
      e;
      this.title = (options != null ? options.name : void 0) || document.title.replace('simpleNote | ', '');
      this.href = (options != null ? options.name : void 0) || location.href;
      this.model.bookmarks.push(this);
    }

    Bookmark.prototype.toJSON = function() {
      return {
        __constructor: 'Bookmark',
        title: this.title,
        href: this.href
      };
    };

    return Bookmark;

  })();

  revive.constructors['Tag'] = Tag;

  revive.constructors['Bookmark'] = Bookmark;

  /*
  * @class Node
  */


  Node = (function() {
    function Node(options) {
      this.toJSON = __bind(this.toJSON, this);
      this.editFiles = __bind(this.editFiles, this);
      this.editListType = __bind(this.editListType, this);
      this.editDeadline = __bind(this.editDeadline, this);
      this.editTags = __bind(this.editTags, this);
      this.archive = __bind(this.archive, this);
      this.toggleBookmarked = __bind(this.toggleBookmarked, this);
      this.toggleExpanded = __bind(this.toggleExpanded, this);
      this.toggleSelected = __bind(this.toggleSelected, this);
      this.makeActive = __bind(this.makeActive, this);
      this.alarm = __bind(this.alarm, this);
      this._delete = __bind(this._delete, this);
      this.remove = __bind(this.remove, this);
      var active,
        _this = this;

      this.id = (options != null ? options.id : void 0) || uuid();
      this.originalParent = null;
      this.title = obs((options != null ? options.title : void 0) || "").extend({
        parse: Node.parseHeadline
      });
      this.notes = obs("").extend({
        parse: Node.parseNote
      });
      this.deadline = obs(null).extend({
        parse: Node.parseDate
      });
      active = obs(false);
      this.selected = obs(false);
      this.realExpanded = obs(false);
      this.expanded = obs({
        read: function() {
          if (window.innerWidth < MAXSCREENWIDTHFORMOBILE) {
            return false;
          } else {
            return _this.realExpanded();
          }
        },
        write: this.realExpanded
      });
      this.listStyleType = obs([]);
      this.editingTitle = obs(false);
      this.editingNote = obs(false);
      this.children = obs([]);
      this.tags = obs([]);
      this.tags.extend({
        pickFrom: {
          array: vm.tags,
          key: "name"
        }
      });
      this.files = obs([]);
      this.visible = obs(function() {
        var tags, words, _ref2;

        _ref2 = vm.realFilter(), tags = _ref2.tags, words = _ref2.words;
        return vm.current === _this || (!!_this.children.filter('visible').length) || ((tags.length ? !!intersect(_this.tags.map('name'), tags).length : true) && (words.length ? !!(_this.title() + ' ' + _this.notes()).match(new RegExp(words.join('|'), 'i')) : true));
      });
      this.active = obs({
        read: active,
        write: function(v) {
          var node, _i, _len, _ref2;

          if (v === active() || v === false) {
            return active(v);
          }
          _ref2 = vm.nodes();
          for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
            node = _ref2[_i];
            node.active(false);
          }
          active(true);
          return _this.editingTitle(true);
        }
      });
      this.hasNote = obs(function() {
        return _this.notes().length;
      });
      this.hasChildren = obs(function() {
        return _this.children().length;
      });
      this.cssClass = obs(function() {
        return _this.listStyleType().concat("node").filter(Boolean).join(" ");
      });
      this.bullet = obs(function() {
        return ((_this.hasNote() || _this.hasChildren()) && ((!_this.expanded() && Node.bullets.right) || (_this.expanded() && Node.bullets.down))) || Node.bullets.round;
      });
      this.forcedparent = obs(null);
      this.parent = obs({
        read: function() {
          return _this.forcedparent() || vm.nodes.find(function(n) {
            return n.children.has(_this);
          });
        },
        write: function(v) {
          return _this.forcedparent(v);
        }
      });
      this.parents = obs(function() {
        var p, x;

        if (_this.parent() === null) {
          return [];
        }
        p = [_this.parent()];
        while ((x = p[0].parent()) !== null) {
          p.unshift(x);
        }
        return p;
      });
      this.deadlineDisplay = (function() {
        var personalTimer, subscribed, subscription;

        personalTimer = obs(null);
        subscribed = obs(false);
        subscription = null;
        subscribed.subscribe(function(v) {
          if (v === true) {
            return subscription = time.subscribe(function(w) {
              return personalTimer(w);
            });
          } else {
            return typeof subscription.dispose === "function" ? subscription.dispose() : void 0;
          }
        });
        return obs(function() {
          var d;

          personalTimer();
          d = _this.deadline();
          if (d === null) {
            return "";
          }
          if (d > now()) {
            subscribed(true);
            return moment(d).fromNow();
          }
          subscribed(false);
          _this.alarm();
          return "";
        }).extend({
          throttle: 1
        });
      })();
      vm.nodes.push(this);
      Node.nodes.push(this);
      if (options != null ? options.parent : void 0) {
        if (options.position) {
          options.parent.children.splice(options.position, 0, this);
        } else {
          options.parent.children.push(this);
        }
      }
      this;
    }

    Node.prototype.open = function() {
      return hash(this.id);
    };

    Node.prototype.remove = function() {
      if (confirm('really delete this node?')) {
        return this._delete();
      }
    };

    Node.prototype._delete = function() {
      if (this === vm.current()) {
        vm.current(this.parent());
      }
      this.parent().children.remove(this);
      return vm.nodes.remove(this);
    };

    Node.prototype.alarm = function() {
      var _base;

      vm.notifications.push(this.deadline() + '\n' + this.title());
      this.deadline(null);
      return typeof (_base = vm.pop).play === "function" ? _base.play() : void 0;
    };

    Node.prototype.makeActive = function() {
      return this.active(true);
    };

    Node.prototype.toggleSelected = function() {
      return this.selected(!this.selected());
    };

    Node.prototype.toggleExpanded = function() {
      if (window.innerWidth < MAXSCREENWIDTHFORMOBILE) {
        return this.open();
      }
      if (!this.hasNote() && !this.hasChildren()) {
        return;
      }
      return this.expanded(!this.expanded());
    };

    Node.prototype.toggleBookmarked = function() {
      return this.bookmarked(!this.bookmarked());
    };

    Node.prototype.archive = function() {
      this.selected(false);
      this.originalParent = this.parent();
      this.parent().children.remove(this);
      return vm.archive.children.push(this);
    };

    Node.prototype.editTags = function(n, e) {
      this.active(true);
      return vm.$tagsMenu.trigger('call', [n, e]);
    };

    Node.prototype.editDeadline = function() {
      return this.deadline((prompt('set a deadline', new Date())) || null);
    };

    Node.prototype.editListType = function() {};

    Node.prototype.editFiles = function() {};

    Node.prototype.toJSON = function() {
      return {
        __constructor: 'Node',
        id: this.id,
        title: escape(this.title()),
        notes: escape(this.notes()),
        deadline: this.deadline(),
        expanded: (this.hasNote() || this.hasChildren()) && this.realExpanded(),
        listStyleType: this.listStyleType(),
        children: this.children(),
        tags: this.tags(),
        originalParent: this.originalParent
      };
    };

    Node.fromJSON = function(data) {
      var instance;

      delete data.__constructor;
      instance = new Node();
      return ko.map(instance, data);
    };

    Node.parseNote = function(v) {
      return v.replace(/(<br>|\n|\r)$/i, "");
    };

    Node.parseHeadline = function(v) {
      return v.replace(/<br>|\n|\r/ig, "");
    };

    Node.parseDate = function(v) {
      var x;

      if (v === null) {
        return null;
      }
      if (isDate(x = new Date(v)) || isDate(x = new Date(parseInt(v))) || isDate(x = Date.intelliParse(v))) {
        return x;
      }
      return null;
    };

    Node.bullets = {
      right: "full",
      down: "full open",
      round: "empty"
    };

    Node.nodes = obs([]);

    return Node;

  })();

  revive.constructors['Node'] = Node;

  $(window).on({
    'online': function() {
      return typeof $vm.trigger === "function" ? $vm.trigger('online') : void 0;
    },
    'offline': function() {
      return typeof $vm.trigger === "function" ? $vm.trigger('offline') : void 0;
    },
    'appupdating': function() {
      return $(function() {
        return $('#curtain div').append('.');
      });
    },
    'appupdateready': function() {
      log('app update ready');
      $(function() {
        return $('#curtain div').append('<br>new version available.<br>please wait a second, or reload<br>the page manually');
      });
      return timeout.set(1000, function() {
        return location.reload();
      });
    },
    'appcacheready': function() {
      var view;

      log('appCache is ready');
      view = 'body';
      vm = new SimpleNote();
      window.note = vm;
      window.SN = SimpleNote;
      vm.activeBookmark = Bookmark.active;
      vm.toggleBookmark = Bookmark.toggle;
      $vm = $(vm);
      $(function() {
        $.extend(vm, {
          $doc: $(document),
          doc: document,
          $win: $(window),
          win: window,
          $view: $(view),
          view: $(view)[0],
          pop: $('audio')[0]
        });
        ko.applyBindings(vm, vm.view);
        return $vm.trigger('appsetupready');
      });
      return null;
    },
    'appReady': function() {
      return liftCurtains();
    }
  });

  $(window.applicationCache).on({
    'noupdate': function() {
      return $win.trigger('appcacheready');
    },
    'error': function() {
      return $win.trigger('appcacheready');
    },
    'progress': function() {
      return $win.trigger('appupdating');
    },
    'updateready': function() {
      return $win.trigger('appupdateready');
    }
  });

  (function() {
    var addconstructor, page, specialPages, _i, _len;

    specialPages = [
      {
        id: 'help',
        title: 'simplenote manual',
        notes: "<p>simplenote aims to be your favorite outline tool.</p>\n\n<p>it evolved from the idea to bring the great and powerful org-mode from the geeky hands of linux-fans to the web. and maybe give it a facelift in the process.</p>\n\n<p>click on a bullet (&nbsp;&bull;&nbsp;) or doubleclick an item title to open it and learn more about this tool.</p>\n<p>to get back to your notebook, click the menu button on the top right ( <i class='icon-ellipsis-vertical'></i> ) and choose the notebook from the appearing menu</p>",
        children: [
          {
            id: 'help-first-step',
            title: 'first step',
            notes: "<b> congratulations! </b>\n<p>you did your first step already by opening this page!</p>\n<p>see how the breadcrumbs above got updated? use them to easily navigate into the depths of your notebook.</p>\n<p>with your own notes there will be an action bar appearing below the breadcrumbs with buttons to change tags, deadlines, files and more.</p>  \n<p>items with content will have a halo (&nbsp;<span class='bullet full'></span>&nbsp;) while those without details or subitems won't (&nbsp;&bull;&nbsp;).</p>\n<p>use the breadcrumbs to get back to the first help page</p>"
          }, {
            id: 'help-menu',
            title: 'menu allmighty',
            notes: "<p>click the menu icon ( <i class='icon-ellipsis-vertical'></i> ) to open up simplenote's menu. click on the items below to learn what each of the menu items does.</p>",
            children: [
              {
                id: 'help-menu-notebook',
                title: '<i class=\'icon-book\'></i>&nbsp;notebook',
                notes: "<p>at its core, simplenote is just a note-taking app, so you will propably spend the most of your time here.</p>\n<p>you will learn more on how to work with simplenote when you progress to the chapters about working on a desktop or mobile screen.</p>\n<p>or you can just skip <a href='#help-desktop'>there</a> or <a href='#help-mobile'>there</a>.</p>"
              }, {
                id: 'help-menu-agenda',
                title: '<i class=\'icon-time\'></i>&nbsp;agenda',
                notes: "<b> coming soon </b>"
              }, {
                id: 'help-menu-calendar',
                title: '<i class=\'icon-calendar\'></i>&nbsp;calendar',
                notes: "<b> coming soon </b>"
              }, {
                id: 'help-menu-timesheet',
                title: '<i class=\'icon-ticket\'></i>&nbsp;timeheet',
                notes: "<b> coming soon </b>"
              }, {
                id: 'help-menu-archive',
                title: '<i class=\'icon-folder-open-alt\'></i>&nbsp;archive',
                notes: "<p>do not throw away<br>\n&nbsp;&nbsp;but do archive instead.</p>\n<p>instead of deleting items, you can archive them, and they will appear in your archive. from here, you can restore them and move them back to your notebook.</p>\n<p>do not be concerned about a huge archive slowing down your loading times. the archive is loaded seperately, <u>after</u> your notebook.</p>"
              }, {
                id: 'help-menu-options',
                title: '<i class=\'icon-cog\'></i>&nbsp;options',
                notes: "<p> well, thats obvious, isn't it? </p>"
              }
            ]
          }, {
            id: 'help-desktop',
            title: 'simplenote on a large screen',
            notes: "<p>so you are using simplenote on a large screen. beautiful!</p>\n<p>when you hover above a note, you will notice a small plus sign appearing left to the bullet (&nbsp;+ &bull;&nbsp;). use this to fold or unfold an item and instantly see its contents. you wont have this feature on a small screen, but there isnt enough space for folding anyway. the plus sign won't appear in the help or options sections either.</p>\n<p>also you will notice a square on the right side of the item you are hovering over (&nbsp;<i class='icon-check-empty'></i>&nbsp;). use this to select (&nbsp;<i class='icon-check'></i>&nbsp;) one or multiple items to perform operations on them.</p>\n<p>to the left of the checkbox appears an tag icon with a plus sign (&nbsp;<i class='icon-tag'>+</i>&nbsp;). click it to edit the tags on your item. this, too, won't be available on smaller screens.</p>"
          }, {
            id: 'help-mobile',
            title: 'simplenote on a mobile phone',
            notes: "<p>so you are using simplenote on a mobile screen. nifty!</p>\n<p>use the bullets (&nbsp;&bull;&nbsp;) and breadcrumbs to navigate through your notebook.</p>\n<p>on the right side of each item you will see a checkbox (&nbsp;<i class='icon-check-empty'></i>&nbsp;). use it to select (&nbsp;<i class='icon-check'></i>&nbsp;) one or multpile items to perform operations on them.</p>"
          }, {
            id: 'help-search',
            title: 'simplenote search',
            notes: "<p>narrow your current view down by using the search bar. you can also search for items with certain tags if you prepend a hash to the tag like (&nbsp;#work&nbsp;).</p>\n<p>when you hover over the search bar, notice how the magnifying glass changes to a cross? use the cross to clear your search and get back to the mess that your notebook is</p>"
          }, {
            id: 'help-tags',
            title: 'simplenote tags',
            notes: "<p><b>Desktop</b><br>\nwhen you hover above a note, you will see a tag icon appearing on the right hand side (&nbsp;<i class='icon-tag'></i>&nbsp;). use this to add or remove tags to your notes. click on a tag which is already assigned to the note you are working on to toggle it off.</p>\n<p><b>Mobile &amp; Desktop</b></br>\nafter selecting one ore more tags, use the appearing menu to toggle the tags on all selected items.</p>\n<p>you can also edit the tags for the current top item with the tag icon located below the breadcrumbs.</p>\n<p>you can search for items with certain tags by prepending a hash like (&nbsp;#work&nbsp;). or you can use the dropdown menu which will appear when you click on the tag icon in the search bar</p>\n<p>in the same dropdown, you will notice a pencil (&nbsp;<i class='icon-pencil'></i>&nbsp;) and a trashcan (&nbsp;<i class='icon-trash'></i>&nbsp;). need a hint what to do with 'em? okay: the pencil renames and repaints the tag and the trashcan trashes it. pretty straightforward, isn't it?</p>\n<p>when picking the color for your tags you can either choose a hex color like (&nbsp;#FF00FF&nbsp;) or a CSS-friendly color name like (&nbsp;CornflowerBlue&nbsp;). for a complete list and some inspiration, check <a href='http://www.w3schools.com/cssref/css_colornames.asp'>W3schools Color Names</a>.</p>"
          }, {
            id: 'help-bookmarks',
            title: 'simplenote bookmarks',
            notes: "<p>selecte one or multiple items and bookmark them with a click on the star icon (&nbsp;<i class='icon-star'></i>&nbsp;) on the appearing menu.</p>\n<p>or use the star icon below the breadcrumbs for the same task</p>\n<p>when you click on the star icon in the search bar, you will get a list of all your bookmarked items.</p>\n<p>in this dropdown, see the half-star on the right side (&nbsp;<i class='icon-star-half-full'></i>&nbsp;)? you can click it to remove a bookmark instantly</p>"
          }, {
            id: 'help-deadlines',
            title: 'simplenote deadlines',
            notes: "<p>on the right side of every note you will see a clock icon appearing when you move your mouse over it. use this clock to set a deadline.</p>\n<p>you can also use the clock icon below the breadcrumbs to do the same.</p>\n<p>when setting a deadline, you can also use natual language. try setting an alarm for ( in a week ) for example. if the clock doesn't recognize what you are trying to say, <a href='mailto:" + email + "'>give me a shout</a> and i will teach the clock new tongues.</p>\n<p>to delete a deadline, simply pass an empty string in the prompt</p>"
          }, {
            id: 'help-hotkeys',
            title: 'simplenote hotkeys',
            notes: "<div class='options'>\n<p>making hotkeys available through javascript is not the easiest task, so bear with me if one or the other does not work in your favorite browser.</p>\n<table data-bind='table:{data:options.hotkeys,cols:[\"hotkey\",\"works on\",\"does\"]}'></table>\n</div>"
          }, {
            id: 'help-offline',
            title: 'simplenote offline',
            notes: "<p>you won't have to do anything special to work offline with simplenote. everything is saved in your browser as you type. go online. go offline. simplenote doesn't care.</p>\n<p>on the bottom of the screen you will see a small notification which will tell you if it is connected to the server or not. but have no fear, the server DOES NOT get any data from simplenote, only the other way around.</p>"
          }, {
            id: 'help-sync',
            title: 'simplenote sync',
            notes: "<p>you want to use simplenote on all of your devices? simplenote will gladly help you.</p>\n<p>swing by the <a href='#options'>options</a> section and connect simplenote to your favorite online storage system.</p>"
          }
        ]
      }, {
        id: 'options',
        title: 'options',
        notes: "<p>not too much to see here yet, but feel free to play around.</p>\n<p>if you're missing an option, <a href='mailto:" + email + "'>raise your voice</a>, and i'll be glad to help you out.</p>",
        children: [
          {
            id: 'options-appearance',
            title: 'appearance',
            notes: "<ul class='options'>\n  <li><input type='checkbox' data-bind='checkbox:options.appearance.titles' />show current title on sheet instead of breadcrumbs</li>\n  <li><input type='checkbox' data-bind='checkbox:options.appearance.flatUI' />use flat UI theme</li>\n</ul>"
          }, {
            id: 'options-print',
            title: 'print',
            notes: "<ul class='options'>\n  <li><input type='checkbox' data-bind='checkbox:options.print.breadcrumbs' />show breadcrumbs on printout</li>\n  <li><input type='checkbox' data-bind='checkbox:options.print.tags' /> show tags on printout</li>\n  <li><input type='checkbox' data-bind='checkbox:options.print.colors' /> print color ( e.g. in tags ) document</li>\n</ul>"
          }, {
            id: 'options-storage',
            title: 'data storage options',
            notes: "<div class='options'>\n<h3>localStorage</h3>\n<p>localStorage is the limited space simplenote has reserved within your browser. this will allow you to save notes across different tabs, but not across different browsers, nor across different devices. it will allow you to work offline, though, and is thus an essential part of simplenote. but because the space is limited, simplenote won't save any attachments ( lets say, a picture ) in the localStorage. therefore, you won't be able to add attachments when you're not connected to a storage service. you may be able to view attachments offline, if your browser cached it, but i won't guarantee that.</p>\n<p>if you decide to connect simplenote to a storage service of your choice ( and well, MY choice too ), you will be able to upload attachments and view them right out of simplenote as long as you're online and connected to this service. if you want to change your online storage service, please make sure to download all your attachments and then upload them to your new provider.</p>\n<h3>Dropbox</h3>\n<div class='options'>\n  <p>your dropbox account is <span data-bind='html:syncModules.dropbox.statusText,style:{color:syncModules.dropbox.statusColor}'</span></p>\n<p data-bind='ifnot:connection.dropbox.status'>\n  <span class='a dropbox' href='javascript:;' data-bind='click:syncModules.dropbox.connect'><i class='icon-cloud'></i>&nbsp;connect your dropbox</span>\n</p>\n<p data-bind='if:connection.dropbox.status'>\n  <span class='a' data-bind='click:sync.disconnect'><i class='icon-cloud'></i>&nbsp;disconnect your dropbox</span>\n</p>\n</div>"
          }
        ]
      }, {
        id: 'about',
        title: 'about simplenote',
        notes: "<div class='options'>\n<p>version : <span data-bind='text:$root.build.version'></span> - <span data-bind='text:$root.build.revision'></span></p>\n<p>last build: <span data-bind='text:$root.build.date'></span></p>\n<p>author : <a data-bind='attr:{href:\"mailto:\"+$root.build.email},text:$root.build.author'></a></p>\n<p>github : <a data-bind='attr:{href:$root.build.github},text:$root.build.github'></a></p>\n<p>if you have trouble using simplenote or have found a bug or have an idea you would love to see come to live in simplenote. write me a mail or drop by my github page.</p>"
      }
    ];
    addconstructor = function(n) {
      var c, _i, _len, _ref2, _results;

      n.__constructor = 'Node';
      n.readonly = true;
      if (n.children) {
        _ref2 = n.children;
        _results = [];
        for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
          c = _ref2[_i];
          _results.push(addconstructor(c));
        }
        return _results;
      }
    };
    for (_i = 0, _len = specialPages.length; _i < _len; _i++) {
      page = specialPages[_i];
      addconstructor(page);
    }
    return $(window).on('appReady', function() {
      return JSON.parse(JSON.stringify(specialPages), revive);
    });
  })();

}).call(this);
