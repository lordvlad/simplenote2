(function(){var t,e,n,i,o,r,s,a,l,c,u,h,d,p,f,m,g,v,y,b,w,k,S,N={}.hasOwnProperty,x=function(t,e){return function(){return t.apply(e,arguments)}};f=480,c=jQuery.isFunction,a=jQuery.isArray,h=jQuery.isPlainObject,u=jQuery.isNumeric,d=function(t){return"string"==typeof t},l=function(t){return"[object Date]"!==Object.prototype.toString.call(t)?!1:!isNaN(t.getTime())},k={set:function(t,e){return setTimeout(e,t)},clear:function(t){return clearTimeout(t)}},s={set:function(t,e){return setInterval(e,t)},clear:function(t){return clearInterval(t)}},i=function(t){return k.set(1,t)},b={set:function(t,e){return localStorage.setItem(t,d(e)?e:JSON.stringify(e))},get:function(t){return JSON.parse(localStorage.getItem(t),v)},remove:function(t){return localStorage.removeItem(t)}},v=function(t,e){var n;return e&&e.__constructor&&(n=window[e.__constructor]||v.constructors[e["class"]])&&"function"==typeof n.fromJSON?n.fromJSON(e):e},v.constructors=[],g=function(t,e){switch(!1){case!(t&&(t.call||t.read||t.write)):return ko.computed(t);case!(t&&t.map):return ko.observableArray(t,e||this);default:return ko.observable(t)}},S=function(){var t,e;return e=[],t=function(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)},function(){for(var n;;)if(n=t(),!~e.indexOf(n))break;return e.push(n),n}}(),m=function(){return new Date},w=function(){var t;return t=g(0),s.set(1e3,function(){return t(m())}),t}(),y=function(t){var e;switch(!1){case!u(t):return t.split("").length;case!d(t||a(t)):return t.length;case!h(t):return function(){var n;n=[];for(e in t)N.call(t,e)&&n.push(e);return n}().length;default:return null}},p=function(t,e){var n,i;for(n in e)i=e[n],ko.isWriteableObservable(t[n])?t[n](i):t[n]=i;return t},o=window.hash=function(){var t,e;return t=g(""),e=function(){return t(location.hash.replace(/#/,"")||"")},$(window).on("hashchange",e),t.subscribe(function(t){return location.hash=t}),e(),t}(),r=window.intersect=function(t,e){return t.filter(function(t){return~e.indexOf(t)})},$.extend(!0,window,{ESC:27,ENTER:13,TAB:9,BACKSPACE:8,SPACE:32,UP:38,DOWN:40,LEFT:37,RIGHT:39,DEL:46,HOME:36,PGUP:33,PGDOWN:34,END:35}),n=function(){function n(n){this.toggleInFilter=x(this.toggleInFilter,this),this._delete=x(this._delete,this),this.remove=x(this.remove,this),this.edit=x(this.edit,this),this.toJSON=x(this.toJSON,this);var i=this;this.id=S(),this.model=e.activeInstance,this.name=g((null!=n?n.name:void 0)||""),this.color=g((null!=n?n.color:void 0)||"white"),this.fgColor=g(function(){var t,e;return e=[],t=(e[0]=new RGBColor(i.color())).foreground(),delete e[0],t}),this.count=g(function(){return t.nodes.filter(function(t){return t.tags.has(i)}).length}),this.model.tags.push(this),this.model.save()}return n.fromJSON=function(t){var i,o;return(o=e.activeInstance.tags.find("id",t.id))?o:(delete t.__constructor,i=new n,p(i,t))},n.prototype.toJSON=function(){return{__constructor:"Tag",id:this.id,name:this.name(),color:this.color()}},n.prototype.edit=function(){return this.name(prompt("change name from "+this.name()+" to ...",this.name())),this.color(prompt("change color from "+this.color()+" to ...",this.color())),this.model.save()},n.prototype.remove=function(){return confirm("really delete tag '"+this.name()+"'?")?this._delete:void 0},n.prototype._delete=function(){var t,e,n,i,o;for(this.model.tags.remove(this),i=this.model.nodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.tags.remove(this));return o},n.prototype.toggleInFilter=function(t,e){return console.log(arguments),$(e.target).is(".icon-trash, .icon-pencil")?void 0:(this.model.searchFilter().match("#"+this.name())?this.model.searchFilter(this.model.searchFilter().replace("#"+this.name(),"").replace(/\s{2,}/g," ").replace(/^\s*|\s*$/g,"")+" "):this.model.searchFilter((this.model.searchFilter()+" #"+this.name()).replace(/\s{2,}/g," ").replace(/^\s*|\s*$/g,"")+" "),this.model.editingFilter(!0))},n}.call(this),t=function(){function t(n){this.toJSON=x(this.toJSON,this),this.editFiles=x(this.editFiles,this),this.editListType=x(this.editListType,this),this.editDeadline=x(this.editDeadline,this),this.editTags=x(this.editTags,this),this.toggleBookmarked=x(this.toggleBookmarked,this),this.toggleExpanded=x(this.toggleExpanded,this),this.toggleSelected=x(this.toggleSelected,this),this.makeActive=x(this.makeActive,this),this.alarm=x(this.alarm,this),this._delete=x(this._delete,this),this.remove=x(this.remove,this);var i,o=this;this.model=e.activeInstance,this.id=S(),this.title=g("").extend({parse:t.parseHeadline}),this.notes=g("").extend({parse:t.parseNote}),this.deadline=g(null).extend({parse:t.parseDate}),i=g(!1),this.bookmarked=g(!1),this.selected=g(!1),this.done=g(!1),this.archived=g(!1),this.realExpanded=g(!1),this.expanded=g({read:function(){return f>window.innerWidth?!1:o.realExpanded()},write:this.realExpanded}),this.listStyleType=g([]),this.editingTitle=g(!1),this.editingNote=g(!1),this.children=g([]),this.tags=g([]),this.tags.extend({pickFrom:{array:this.model.tags,key:"name"}}),this.files=g([]),this.visible=g(function(){var e;return e=o.model.realFilter(),o.model.current===o||o.children.filter("visible").length||t.checkFilter(o,e)}),this.active=g({read:i,write:function(t){var e,n,r,s;if(t===i()||t===!1)return i(t);for(s=o.model.nodes(),n=0,r=s.length;r>n;n++)e=s[n],e.active(!1);return i(!0)}}),this.hasNote=g(function(){return o.notes().length}),this.hasChildren=g(function(){return o.children().length}),this.cssClass=g(function(){return o.listStyleType().concat("node").filter(Boolean).join(" ")}),this.bullet=g(function(){return(o.hasNote()||o.hasChildren())&&(!o.expanded()&&t.bullets.right||o.expanded()&&t.bullets.down)||t.bullets.round}),this.parent=g(function(){return o.model.nodes.find(function(t){return t.children.has(o)})}),this.parents=g(function(){var t,e;if(null===o.parent())return[];for(t=[o.parent()];null!==(e=t[0].parent());)t.unshift(e);return t}),this.deadlineDisplay=function(){var t,e,n;return t=g(null),e=g(!1),n=null,e.subscribe(function(e){return e===!0?n=w.subscribe(function(e){return t(e)}):"function"==typeof n.dispose?n.dispose():void 0}),g(function(){var n;return t(),n=o.deadline(),null===n?"":n>m()?(e(!0),moment(n).fromNow()):(e(!1),o.alarm(),"")}).extend({throttle:1})}(),this.model.nodes.push(this),t.nodes.push(this),(null!=n?n.parent:void 0)&&n.parent.children.push(this)}return t.prototype.open=function(){return o(this.id)},t.prototype.remove=function(){return confirm("really delete this node?")?this._delete():void 0},t.prototype._delete=function(){return this===this.model.current()&&this.model.current(this.parent()),this.parent().children.remove(this),this.model.nodes.remove(this),this.model.save()},t.prototype.alarm=function(){var t;return this.deadline(null),this.model.save(),"function"==typeof(t=this.model.pop).play&&t.play(),alert(this.title())},t.prototype.makeActive=function(){return this.active(!0)},t.prototype.toggleSelected=function(){return this.selected(!this.selected())},t.prototype.toggleExpanded=function(){return f>window.innerWidth?this.open():this.expanded(!this.expanded())},t.prototype.toggleBookmarked=function(){return this.bookmarked(!this.bookmarked())},t.prototype.editTags=function(t,e){return this.active(!0),this.model.$tagsMenu.trigger("call",[t,e])},t.prototype.editDeadline=function(){return this.deadline(prompt("set a deadline",new Date)||null)},t.prototype.editListType=function(){},t.prototype.editFiles=function(){},t.prototype.toJSON=function(){return{__constructor:"Node",id:this.id,title:escape(this.title()),notes:escape(this.notes()),deadline:this.deadline(),bookmarked:this.bookmarked(),done:this.done(),expanded:this.hasNote()&&this.hasChildren()&&this.realExpanded(),listStyleType:this.listStyleType(),children:this.children(),tags:this.tags()}},t.fromJSON=function(e){var n;return delete e.__constructor,n=new t,p(n,e)},t.parseNote=function(t){return t.replace(/(<br>|\n|\r)$/i,"")},t.parseHeadline=function(t){return t.replace(/<br>|\n|\r/gi,"")},t.parseDate=function(t){var e;return null===t?null:l(e=new Date(t))||l(e=new Date(parseInt(t)))||l(e=Date.intelliParse(t))?e:null},t.checkFilter=function(t,e){var n;return n=!1,n=!e.tags.length||r(t.tags.map("name"),e.tags).length,n=n&&(!e.words.length||(t.title()+" "+t.notes()).match(RegExp(e.words.join("|"),"i")))},t.bullets={right:"&#9658;",down:"&#9660",round:"&#9679;"},t.nodes=g([]),t}(),e=function(){function e(){this.clearSearchFilter=x(this.clearSearchFilter,this),this.removeAlert=x(this.removeAlert,this),this.removeNotification=x(this.removeNotification,this),this.stopSort=x(this.stopSort,this),this.startSort=x(this.startSort,this),this.checkForOptions=x(this.checkForOptions,this),this.removeTag=x(this.removeTag,this),this.addTag=x(this.addTag,this),this.openNode=x(this.openNode,this),this.insertNodeAfter=x(this.insertNodeAfter,this),this.addNodeHere=x(this.addNodeHere,this),this.addNodeTo=x(this.addNodeTo,this),this.selectionEditTags=x(this.selectionEditTags,this),this.selectionRemove=x(this.selectionRemove,this),this.selectionRemoveDeadlines=x(this.selectionRemoveDeadlines,this),this.selectionArchive=x(this.selectionArchive,this),this.selectionInvert=x(this.selectionInvert,this),this.selectionUnselect=x(this.selectionUnselect,this),this.save=x(this.save,this),this.revive=x(this.revive,this),this.toJSON=x(this.toJSON,this),this.attachElements=x(this.attachElements,this);var t=this;e.instances.push(this),this.timeout=null,this.interval=null,this.root=null,this.element=null,this.pop=null,this.searchFilter=g(""),this.editingFilter=g(!1),this.current=g(null),this.alerts=g([]),this.notifications=g([]),this.connectionStatus=g(0),this.connectionStatusText=g(function(){switch(t.connectionStatus()){case 0:return"offline";case 1:return"online"}}),this.connectionStatusColor=g(function(){switch(t.connectionStatus()){case 0:return"red";case 1:return"green"}}),this.dropboxStatus=g(0),this.dropboxStatusText=g(function(){switch(t.dropboxStatus()){case 0:return"not set up";case 1:return"connected";case 2:return"disconnected";case 3:return"synchronizing"}}),this.dropboxStatusColor=g(function(){switch(t.dropboxStatus()){case 0:return"";case 1:return"green";case 2:return"red";case 3:return"orange"}}),this.nodes=g([]),this.tags=g([]),this.realFilter=g(function(){var e,n;return e=t.searchFilter().split(/\s+/),e[0]&&"!"!==(null!=(n=e[0])?n[0]:void 0)?{tags:e.filter(function(t){return t.match(/^#/)}).map(function(t){return t.replace(/#/,"")}),times:e.filter(function(t){return t.match(/^@/)}).map(function(t){return t.replace(/@/,"")}),words:e.filter(function(t){return t.match(/^[^#@]/)})}:{tags:[],times:[],words:[]}}).extend({debounce:500}),this.selectedNodes=g(function(){return t.nodes.filter("selected")}),this.bookmarkedNodes=g(function(){return t.nodes.filter("bookmarked")}),this.breadcrumbs=g(function(){var e;return t.current(),(null!=(e=t.current())?"function"==typeof e.parents?e.parents().concat([t.current()]):void 0:void 0)||[]}),o.subscribe(function(e){var n;return t.current(e&&e.length&&t.nodes.find("id",e)||t.root),null!=(n=t.current())?n.editingNote(!0):void 0})}return e.instances=[],e.prototype.attachElements=function(t){return this.$view=$(t),this.view=this.$view[0],this.pop=$("audio",t)[0],this.$tagsMenu=$("#tagsMenu",t)},e.prototype.toJSON=function(){return{root:this.root,tags:this.tags()}},e.prototype.revive=function(){var e,n;return e=b.get("simpleNote"),e&&e.root?(this.root=e.root,this.tags(e.tags||[])):(n=new t,n.id="simpleNoteRoot",n.title("home"),n.visible=function(){return!0},this.root=n),o.valueHasMutated(),this},e.prototype.save=function(){var t=this;return k.clear(this.timeout),this.timeout=k.set(100,function(){return b.set("simpleNote",t.toJSON())}),this},e.prototype.applyEvents=function(){var t=this;return this.$view.on("click",".headline",function(t){var e;return e=$(t.target),e.is(".bullet, .action, .ellipsis, .additional")?void 0:e.parents(".headline").find("title").focus()}),this.$view.on("keyup, click",function(){return t.save()}),this},e.prototype.startPeriodicalSave=function(){return this.interval=s.set(6e4,this.save),this},e.prototype.stopPeriodicalSave=function(){return s.clear(this.interval),this},e.prototype.selectionUnselect=function(){var t,e,n,i,o;for(i=this.selectedNodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.selected(!1));return o},e.prototype.selectionInvert=function(){var t,e,n,i,o;for(i=this.nodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.selected(!t.selected()));return o},e.prototype.selectionArchive=function(){var t,e,n,i,o;for(i=this.selectedNodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.archived(!0));return o},e.prototype.selectionRemoveDeadlines=function(){var t,e,n,i,o;for(i=this.selectedNodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.deadline(null));return o},e.prototype.selectionRemove=function(){var t,e,n,i,o;if(confirm("really delete "+this.selectedNodes().length+" selected outlines? ATTENTION! Children Nodes will be deleted with their parents!")){for(i=this.selectedNodes(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t._delete());return o}},e.prototype.selectionEditTags=function(){},e.prototype.addNodeTo=function(e,n){return new t($.extend(h(n)?n:{},{parent:e})).editingTitle(!0)},e.prototype.addNodeHere=function(t){console.log(arguments)},e.prototype.insertNodeAfter=function(t,e){return this.addNodeTo(this.current().parent(),e)},e.prototype.openNode=function(t){var e;return o(t&&t.id||(null!=(e=t&&t[0]&&ko.dataFor(t[0]))?e.id:void 0)||t||this.root.id)},e.prototype.addTag=function(){return new n({name:prompt("set a name","")})},e.prototype.removeTag=function(t){var e,n,i,o,r;if(confirm("really delete the tag named "+t.name()+"?")){for(this.tags.remove(t),o=this.nodes(),r=[],n=0,i=o.length;i>n;n++)e=o[n],r.push(e.tags.remove(t));return r}},e.prototype.fadeIn=function(t){return $(t).hide().fadeIn("slow")},e.prototype.fadeOut=function(t){return $(t).fadeOut(function(){return $(t).remove()})},e.prototype.checkForOptions=function(t){var e;return(e=$(".options",t)).length>0&&$("[data-bind]",t).length>0?ko.applyBindings(this,e[0]):void 0},e.prototype.startSort=function(){return console.log("starting sort"),$(".node",this.view).hover(function(){return ko.dataFor($(this)[0]).expanded(!0)},function(){return ko.dataFor($(this)[0]).expanded(!1)})},e.prototype.stopSort=function(){return console.log("stopping sort")},e.prototype.removeNotification=function(t){return this.notifications.remove(t)},e.prototype.removeAlert=function(t){return this.alerts.remove(t)},e.prototype.clearSearchFilter=function(){return this.searchFilter("")},e}(),e.liststyletypes=[{name:"none",value:[]},{name:"1, 2, 3",value:["decimal"]},{name:"1., 2., 3.",value:["decimal","dot"]},{name:"1.1, 1.2, 1.3",value:["decimal","dot","add"]},{name:"a, b, c",value:["lowerAlpha"]},{name:"(a), (b), (c)",value:["lowerAlpha","dot"]},{name:"A, B, C",value:["upperAlpha"]},{name:"(A), (B), (C)",value:["upperAlpha","dot"]}],$(function(){return function(){var t,n,i,o,r,s;return i=e.activeInstance,r=0,o=5,s=2,n=60,t=function(){return $.get("online/online.json").error(function(){return i.connectionStatus(0),k.set(1e3*(o>r++?s:n),t)}).done(function(){return i.connectionStatus(1),r=0,k.set(1e3*n,t)})},t()}()}),function(o,r,s){return applicationCache.onchecking=function(){return o.holdReady(!0)},applicationCache.ondownloading=function(){return o.holdReady(!0)},applicationCache.onerror=function(){return o.holdReady(!1),s.connectionStatus(0)},applicationCache.onnoupdate=function(){return o.holdReady(!1),s.connectionStatus(1)},applicationCache.onprogress=function(){return i(function(){return o("#curtain").find("i").after(".")})},applicationCache.onupdateready=applicationCache.oncached=function(){return i(function(){return location.href="index.html"}),k.set(1e3,function(){return o("#curtain").find("i").after("<br>there is a new version of this app.<br>please <a style='color:cyan' href='index.html'>reload the page manually</a>").find("a").focus()})},o(function(){return o.extend(!0,window,{SimpleNote:e,note:s,Node:t,Tag:n}),ko.applyBindings(s,s.view),s.attachElements(r),s.revive(),s.applyEvents(),s.startPeriodicalSave(),o("#tagsMenu",r).data("node",null).on("dismiss",function(){return o(this).fadeOut("fast",function(){return o(this).css({top:"",left:""})})}).on("call",function(t,e,n){var i;return o(document).off("click.tagsmenu"),i=o(this).position({my:"right top",at:"right bottom",of:n.target}).fadeIn("fast").data("node",e),i.find("input").focus(),o(document).on("click.tagsmenu",function(t){return t.timeStamp!==n.timeStamp&&0===o(t.target).parents("#tagsMenu").length?(o(document).off("click.tagsmenu"),i.trigger("dismiss")):void 0})}).on("click","li.list",function(){var t,e;return e=ko.dataFor(this),t=o(this).parents("#tagsMenu").data("node"),0===t.tags.remove(e).length?t.tags.push(e):void 0}).on("click","i.icon-plus",function(){var t;if(t=o(this).next().val())return o(this).parents("#tagsMenu").data("node").tags.push(new n({name:t})),o(this).next().val("").focus()}).on("keydown","input",function(t){return t.which===ESC&&o(this).parents("#tagsMenu").trigger("dismiss"),t.which===ENTER?o(this).prev().trigger("click"):void 0}),o("#search > div >.icon-tags",r).click(function(t){return s.editingFilter(!0),o("#tags").is("visible")?o("#tags").slideUp():(o("#tags").slideDown("fast"),o(document).on("click.tagsfilter",function(e){return t.timeStamp===e.timeStamp||o(e.target).is(".icon-trash")?void 0:(o(document).off("click.tagsfilter"),o("#tags").slideUp("fast"))}))}),o("#search > div >.icon-star",r).click(function(t){return s.editingFilter(!0),o("#bookmarks").is("visible")?o("#bookmarks").slideUp():(o("#bookmarks").slideDown("fast"),o(document).on("click.bookmarks",function(e){return t.timeStamp===e.timeStamp||o(e.target).is(".icon-star-half")?void 0:(o(document).off("click.bookmarks"),o("#bookmarks").slideUp("fast"))}))}),i(function(){return o("#curtain").fadeOut("slow",function(){return o("body").css("overflow","auto")})}),null})}(jQuery,"body",e.activeInstance=new e),function(e,n,i){var o,r,s,a,l,c,u,h,d,p,f,m,g;for(o=new t,o.id="help",o.title("help"),o.parents=function(){return[i.root]},o.notes("<h1>welcome to simplenote help.</h1>\nhere, i will try to help you getting startet with this awesome little outliner.<br><br>    \ndoubleclick the title or click ( details... ) to open the first node titled 'first steps'. \nif you are using a mobile device, there won't be a ( details... ) link. instead, use the triangle ( "+t.bullets.right+" ) to open the item."),s=new t,s.id="help-firstStep",s.title("first step"),s.parents=function(){return[i.root,o]},s.notes("<h3>you opened your first node, YAY!</h3>\nsee how the breadcrumbs above got updated? they provide you a path back to the root.<br><br>\ntry to get back to the 'help' page!"),a=new t,a.id="help-secondStep",a.title("second step"),a.parents=function(){return[i.root,o]},a.notes("you can also use the little triangles ( "+t.bullets.right+" ) on the side to unfold items <b>if</b> they have more content to them.\nnote that on mobile devices this will not unfold but open the item."),l=new t,l.id="help-withoutcontent",l.title("i'm empty :("),l.parents=function(){return[i.root,o,a]},c=new t,c.id="help-withcontent",c.title("i have more to show"),c.parents=function(){return[i.root,o,a]},c.notes("see? i have some details "),u=new t,u.id="help-withcontentcontent",u.title("and another subnote"),u.parents=function(){return[i.root,o,a,c]},r=new t,r.id="help-offline",r.title("working offline"),r.parents=function(){return[i.root,o]},r.notes("simplenote is capable of working offline, too, because all data is saved only in your browser anyway!<br><br>\non the bottom of the page, there is a small identifier which will update if you loose or gain an internet connection"),h=new t,h.id="help-dropbox",h.title("keep in sync with dropbox"),h.parents=function(){return[i.root,o]},h.notes("<div class='options'>\nyou can use dropbox to keep your notes synced across all your devices.<br><br>\nright now, your dropbox is <span data-bind='text:$root.dropboxStatusText,style:{color:$root.dropboxStatusColor}'></span><br><br>\nyou will see your dropbox status at the bottom of the page,too.<br><br>\ncheck the <a href='#options-dropbox'>dropbox options</a> page.\n</div>"),o.children([s,a,r,h]),a.children([l,c]),c.children([u]),m=[o,r,s,a,l,c,u,h],g=[],p=0,f=m.length;f>p;p++)d=m[p],g.push(function(){return d.remove=function(){return alert("cannot delete this node")},d._delete=function(){return null},d.readonly=!0}());return g}(jQuery,"body",e.activeInstance)}).call(this);